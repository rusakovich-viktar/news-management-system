# Система управления новостями

## Техническое задание
Разработать RESTful web-service, реализующей функционал для работы с системой управления новостями.

### Основные сущности:
-	news (новость) содержит поля: id, time, title, text и comments (list).
-	comment содержит поля: id, time, text, username и news_id.

### Требования:
1.	Использовать Spring Boot 3.x, Java 17, Gradle и PostgreSQL. 
2.	Разработать API согласно подходам REST (UI не надо):
       - CRUD для работы с новостью
       - CRUD для работы с комментарием
       - просмотр списка новостей (с пагинацией)
       - просмотр новости с комментариями относящимися к ней (с пагинацией)
         - /news
         -	/news/{newsId}
         -	/news/{newsId}/comments
       - полнотекстовый поиск по различным параметрам (для новостей и комментариев). Для потенциально объемных запросов реализовать постраничность
3.	Разместить проект в любом из публичных git-репозиториев (Bitbucket, github, gitlab)
4.	Код должен быть легко читаемый и понятный, с использованием паттернов проектирования
5.	Реализовать на основе Spring @Profile (e.g. test & prod) подключение к базам данных. 
6.	Подключить liquibase: 
      - при запуске сервиса накатываются скрипты на рабочую БД (генерируются необходимые таблицы из одного файла и наполняются таблицы данными из другого файла, 20 новостей и 10 комментариев, связанных с каждой новостью
      - при запуске тестов должен подхватываться скрипт по генерации необходимых таблиц + накатить данные по заполнению таблиц (третий файл)
7.	Создать реализацию кэша, для хранения сущностей. Реализовать два алгоритма  LRU и LFU. Алгоритм и максимальный размер коллекции должны читаться из файла application.yml. Алгоритм работы с кешем:
      -	GET - ищем в кеше и если там данных нет, то достаем объект из dao, сохраняем в кеш и возвращаем
      -	POST - сохраняем в dao и потом сохраняем в кеше
      -	DELETE - удаляем из dao и потом удаляем в кеша
      -	PUT - обновление/вставка в dao и потом обновление/вставка в кеше.
8.	Весь код должен быть покрыт юнит-тестами (80%) (сервисный слой – 100%)
9.	Реализовать логирование запрос-ответ в аспектном стиле (для слоя Controlles), а также логирование по уровням в отдельных слоях приложения, используя logback
10.	Предусмотреть обработку исключений и интерпретацию их согласно REST (см. https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc)
11.	Все настройки должны быть вынесены в *.yml
12.	Код должен быть документирован @JavaDoc, а назначение приложения и его интерфейс и настройки должны быть описаны в README.md файле
13.	Использовать Spring REST Docs или другие средства автоматического документирования (например asciidoctor https://asciidoctor.org/docs/asciidoctor-gradle-plugin/ и т.д) и/или Swagger (OpenAPI 3.0)
14.	Использовать testcontainers в тестах на persistence layer (для БД)
15.	Написать интеграционные тесты
16.	Использовать WireMock в тестах для слоя clients (разбиение на микросервисы)
17.	Использовать Docker (написать Dockerfile – для spring boot приложения, docker-compose.yml для поднятия БД и приложения в контейнерах и настроить взаимодействие между ними)

18. <sup>*</sup> Подключить кэш провайдер Redis (в docker) (в случае реализации, использовать @Profile для переключения между LRU/LFU и Redis)
19.	<sup>*</sup> Spring Security:
       -	API для регистрации пользователей с ролями admin/journalist/subscriber
       -	Администратор (role admin) может производить CRUD-операции со всеми сущностями
       -	Журналист (role journalist) может добавлять и изменять/удалять только свои новости 
       -	Подписчик (role subscriber) может добавлять и изменять/удалять только свои комментарии
       -	Незарегистрированные пользователи могут только просматривать новости и комментарии
Создать отдельный микросервис с реляционной базой (postgreSQL) хранящей
информацию о пользователях/ролях. Из главного микросервиса (отвечающего за
новости) запрашивать эту информацию по  REST с использованием spring-cloud-
feign-client.
20. <sup>*</sup> Настроить Spring Cloud Config (вынести в отдельный сервис и настроить разрабатываемый сервис на получение их в зависимости от профиля)
21.	<sup>*</sup> Реализацию логирования п.9 и обработку исключений п.10 вынести в отдельные
spring-boot-starter-ы.
22.	<sup>**</sup> Сущности веб интерфейса (DTO) должны генерироваться при сборке проекта из .proto файлов (см. https://github.com/google/protobuf-gradle-plugin)


“*” – необходимо минимум выполнить два задания со звёздочкой, больше заданий будет существенным плюсом. К этим пунктам лучше приступать после качественного решения базовых задач с применением принципов SOLID, декларативных подходов, оптимальных алгоритмов.

## Реализация. Общие пояснения к деталям

Здесь расположена общая информация по взаимодействию между микросервисами, а также общие пояснения к заданию. 
Детали реализации по каждому микросервису будут в репозитории конкретного микросервиса.

### Структура основного репозитория:
1. Основной репозиторий включает в себя ссылки все микросервисы и файлы для запуска этих репозиториев в docker:
   - [ОСНОВНОЙ РЕПОЗИТОРИЙ - News Management System](https://github.com/rusakovich-viktar/news-management-system/tree/develop)

2. Репозиторий с общей точкой доступа в сервис с API для клиентов:
   - [micro-gateway](https://github.com/rusakovich-viktar/micro-gateway/tree/develop)
3. Репозиторий с микросервисом новостей:
   - [micro-news](https://github.com/rusakovich-viktar/micro-news/tree/develop)
4. Репозиторий с микросервисом комментариев:
   - [micro-comments](https://github.com/rusakovich-viktar/micro-comments/tree/develop)
5. Репозиторий с микросервисом для полнотекстового поиска в базе данных:
   - [micro-search](https://github.com/rusakovich-viktar/micro-search/tree/develop)
6. Репозиторий с сервером конфигураций для микросервисов:
   - [micro-config-server-cloud](https://github.com/rusakovich-viktar/micro-config-server-cloud/tree/develop)
7. Репозиторий со стартером для логирования действий контроллеров:
   - [logger-aspect-starter](https://github.com/rusakovich-viktar/logger-aspect-starter/tree/develop)
8. Репозиторий со стартером для глобальной обработки исключений:
   - [exception-handler-starter](https://github.com/rusakovich-viktar/exception-handler-starter/tree/develop)
9. Также отдельно находится репозиторий хранящий сами файлы конфигураций:
   - [cloud-yml](https://github.com/rusakovich-viktar/cloud-yml/tree/develop)